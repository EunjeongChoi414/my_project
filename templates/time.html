<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>우리당장만나</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            readyTimetable();
            // initDate();
            // changeColor();
        })

        function readyTimetable() {
            let leader_name = "";
            var temp = location.href.split("?");
            leader_name = temp[1].split(":")[1];

            $.ajax({
                type: "GET",
                url: "/dates?id_give=" + leader_name,
                data: {},
                success: function (response) {
                    if (response["result"] == "success") {
                        makeTimetable(response['dates']);
                    } else {
                        alert("서비스가 고장났습니다..죄송합니다..");
                    }
                }
            })
        }

        function makeTimetable(dates) {
            let setTableHTML = "";
            setTableHTML += '<table class="calendar">';
            setTableHTML += '<tr>'
            setTableHTML += '<th></th>'
            for (let i = 0; i < dates.length; i++) {
                let tableHeader = '<th>' + dates[i] + '</th>';
                setTableHTML += tableHeader;
            }
            setTableHTML += '</tr>'

            for (var i = 0; i < 48; i++) {
                setTableHTML += '<tr height="20">';
                for (var j = 0; j < dates.length +1; j++) {
                    setTableHTML += '<td>';
                    setTableHTML += '    <div class="time_selection"></div>';
                    setTableHTML += '</td>';
                }
                setTableHTML += '</tr>';
            }
            setTableHTML += '</table>';
            $("#time_tab").html(setTableHTML);
            drawTime(dates);

        }
        function drawTime(dates) {
            let $timeBox = $("td div.time_selection")
            let time = ["밤12", "1AM", "2AM", "3AM", "4AM", "5AM", "6AM", "7AM", "8AM", "9AM", "10AM", "11AM", "낮12",
            "1PM", "2PM", "3PM", "4PM", "5PM", "6PM", "7PM", "8PM", "9PM", "10PM", "11PM", "밤12"]

            for (var i = 0; i < (dates.length+1)*48; i += ((dates.length+1)*2) ) {
                $timeBox.eq(i).text(time[i/((dates.length+1)*2)]);
            }

        }


    </script>
    <title>우리당장만나</title>
    <style type="text/css">
        .intro h1 {
            width: 400px;
            margin: 0 auto;
        }

        .intro h3 {
            width: 330px;
            margin: 0 auto;
            padding-top: 30px;
        }

        table {
            border: 1px solid black;
            display: inline-table;
            text-align: center;
            width: 300px;
            border-spacing: 0;
            margin: 0 auto;
        }

        table.calendar td {
            width: 100px;
            vertical-align: top;
            text-align: right;
            border: 1px solid skyblue;
            border-bottom: none;
            font-size:10px;
            font-weight: bold;
            padding-top: 0px;
            cursor: pointer;
        }

        #time_tab {
            margin-left: auto;
            margin-right: auto;
            display: flex;
            width: 50%
        }

        .step3_btn {
            width: 100px;
            margin-left: 80%;
        }
    </style>
</head>
<body>
<div class="intro">
    <h1>나의 가능한 시간 입력하기</h1>
    <h3>가능한 시간을 클릭/드래그 해주세요!</h3>
</div>
<br><br>
<div id="time_tab"></div>
<div class="step3_btn">
    <a href="{{ url_for('when3') }}">다음 STEP</a>
</div>
</body>
</html>